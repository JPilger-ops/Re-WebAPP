generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model bank_settings {
  id             Int       @id @default(1)
  account_holder String
  bank_name      String
  iban           String
  bic            String
  updated_at     DateTime? @default(now()) @db.Timestamp(6)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model category_email_accounts {
  id                 Int                @id @default(autoincrement())
  category_id        Int                @unique
  display_name       String?
  email_address      String
  imap_host          String
  imap_port          Int
  imap_secure        Boolean            @default(true)
  imap_user          String?
  imap_pass          String?
  smtp_host          String?
  smtp_port          Int?
  smtp_secure        Boolean?           @default(true)
  smtp_user          String?
  smtp_pass          String?
  updated_at         DateTime           @default(now()) @db.Timestamp(6)
  invoice_categories invoice_categories @relation(fields: [category_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model category_templates {
  id                 Int                @id @default(autoincrement())
  category_id        Int                @unique
  subject            String?
  body_html          String?
  updated_at         DateTime           @default(now()) @db.Timestamp(6)
  invoice_categories invoice_categories @relation(fields: [category_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model datev_settings {
  id         Int       @id @default(1)
  email      String?
  updated_at DateTime? @default(now()) @db.Timestamp(6)
}

model hkforms_settings {
  id           Int       @id @default(1)
  base_url     String
  organization String?
  api_key      String?
  updated_at   DateTime? @default(now()) @db.Timestamp(6)
}

model invoice_categories {
  id                      Int                      @id @default(autoincrement())
  key                     String                   @unique(map: "idx_invoice_categories_key") @db.VarChar(100)
  label                   String                   @db.VarChar(255)
  logo_file               String?                  @db.VarChar(255)
  created_at              DateTime?                @default(now()) @db.Timestamp(6)
  updated_at              DateTime?                @default(now()) @db.Timestamp(6)
  category_email_accounts category_email_accounts?
  category_templates      category_templates?
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model invoice_items {
  id               Int       @id @default(autoincrement())
  invoice_id       Int?
  description      String
  quantity         Decimal?  @default(1) @db.Decimal(10, 2)
  unit_price_gross Decimal?  @db.Decimal(10, 2)
  vat_key          Int?
  line_total_gross Decimal?  @db.Decimal(10, 2)
  invoices         invoices? @relation(fields: [invoice_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model invoices {
  id                     Int             @id @default(autoincrement())
  invoice_number         String          @db.VarChar(50)
  date                   DateTime        @db.Date
  recipient_id           Int?
  category               String?         @db.VarChar(50)
  reservation_request_id String?         @db.VarChar(100)
  external_reference     String?
  status_sent            Boolean?        @default(false)
  status_sent_at         DateTime?       @db.Timestamp(6)
  status_paid_at         DateTime?       @db.Timestamp(6)
  overdue_since          DateTime?       @db.Timestamp(6)
  canceled_at            DateTime?       @db.Timestamp(6)
  cancel_reason          String?         @db.Text
  datev_export_status    String?         @default("NOT_SENT") @db.VarChar(20)
  datev_exported_at      DateTime?       @db.Timestamp(6)
  datev_export_error     String?
  receipt_date           DateTime?       @db.Date
  net_19                 Decimal?        @db.Decimal(10, 2)
  vat_19                 Decimal?        @db.Decimal(10, 2)
  gross_19               Decimal?        @db.Decimal(10, 2)
  net_7                  Decimal?        @db.Decimal(10, 2)
  vat_7                  Decimal?        @db.Decimal(10, 2)
  gross_7                Decimal?        @db.Decimal(10, 2)
  gross_total            Decimal?        @db.Decimal(10, 2)
  created_at             DateTime?       @default(now()) @db.Timestamp(6)
  b2b                    Boolean?        @default(false)
  ust_id                 String?
  invoice_items          invoice_items[]
  recipients             recipients?     @relation(fields: [recipient_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model recipients {
  id         Int        @id @default(autoincrement())
  name       String     @db.VarChar(255)
  street     String?    @db.VarChar(255)
  zip        String?    @db.VarChar(20)
  city       String?    @db.VarChar(255)
  email      String?    @db.VarChar(255)
  phone      String?    @db.VarChar(100)
  created_at DateTime?  @default(now()) @db.Timestamp(6)
  invoices   invoices[]
}

model role_permissions {
  role_id        Int
  permission_key String @db.VarChar(100)
  roles          roles  @relation(fields: [role_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@id([role_id, permission_key])
}

model roles {
  id               Int                @id @default(autoincrement())
  name             String             @unique @db.VarChar(50)
  description      String?
  role_permissions role_permissions[]
  users            users[]
}

model tax_settings {
  id         Int       @id @default(1)
  tax_number String?
  vat_id     String?
  updated_at DateTime? @default(now()) @db.Timestamp(6)
}

model users {
  id            Int       @id @default(autoincrement())
  username      String    @unique @db.VarChar(100)
  password_hash String
  role          String    @default("user") @db.VarChar(20)
  created_at    DateTime? @default(now()) @db.Timestamp(6)
  is_active     Boolean?  @default(true)
  role_id       Int?
  roles         roles?    @relation(fields: [role_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model schema_migrations {
  filename   String   @id
  applied_at DateTime @default(now()) @db.Timestamptz(6)
}

model smtp_settings {
  id          Int       @id @default(1)
  host        String?   @db.VarChar(255)
  port        Int?
  secure      Boolean?  @default(false)
  user        String?   @db.VarChar(255)
  pass_value  String?   @db.VarChar(1024)
  from        String?   @db.VarChar(255)
  reply_to    String?   @db.VarChar(255)
  updated_at  DateTime? @default(now()) @db.Timestamp(6)
}

model invoice_header_settings {
  id             Int       @id @default(1)
  company_name   String?   @db.VarChar(255)
  address_line1  String?   @db.VarChar(255)
  address_line2  String?   @db.VarChar(255)
  zip            String?   @db.VarChar(50)
  city           String?   @db.VarChar(255)
  country        String?   @db.VarChar(100)
  vat_id         String?   @db.VarChar(100)
  bank_name      String?   @db.VarChar(255)
  iban           String?   @db.VarChar(100)
  bic            String?   @db.VarChar(50)
  footer_text    String?   @db.Text
  logo_url       String?   @db.VarChar(512)
  updated_at     DateTime? @default(now()) @db.Timestamp(6)
}

model api_keys {
  id           Int       @id @default(autoincrement())
  name         String?   @db.VarChar(255)
  key_hash     String    @unique @db.VarChar(128)
  prefix       String    @db.VarChar(32)
  scopes       Json?
  created_at   DateTime  @default(now()) @db.Timestamp(6)
  last_used_at DateTime? @db.Timestamp(6)
  revoked_at   DateTime? @db.Timestamp(6)
}

model pdf_settings {
  id            Int     @id @default(1)
  storage_path  String  @db.Text
}

model email_templates {
  id                   Int       @id @default(1)
  subject_template     String?   @db.Text
  body_html_template   String?   @db.Text
  body_text_template   String?   @db.Text
  updated_at           DateTime? @default(now()) @db.Timestamp(6)
}

model favicon_settings {
  id         Int       @id @default(1)
  filename   String?   @db.VarChar(255)
  updated_at DateTime? @default(now()) @db.Timestamp(6)
}

model network_settings {
  id                    Int       @id @default(1)
  cors_origins          String?   @db.Text
  trust_proxy           Int?      @default(1)
  auth_cookie_samesite  String?   @db.VarChar(10)
  auth_token_ttl_minutes Int?     @default(720)
  updated_at            DateTime? @default(now()) @db.Timestamp(6)
}
