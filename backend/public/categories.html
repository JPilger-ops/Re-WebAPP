<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Einstellungen</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="/style.css" />
</head>
<body>
  <div class="app-shell">
    <aside class="sidebar">
      <div class="sidebar-title">Rechnungsapp</div>
      <nav class="sidebar-nav">
        <button class="nav-item" id="nav-dashboard">Dashboard</button>
        <button class="nav-item" id="nav-invoices">Rechnungsübersicht</button>
        <button class="nav-item" id="nav-create">Neue Rechnung</button>
        <button class="nav-item" id="nav-customers">Kundenverwaltung</button>
        <button id="nav-users" class="nav-item">Benutzerverwaltung</button>
        <button id="nav-account" class="nav-item">Account</button>
        <button id="nav-roles" class="nav-item">Rollenverwaltung</button>
        <button id="nav-categories" class="nav-item nav-item-active">Einstellungen</button>
        <button id="nav-logout" class="nav-item" style="color:#b20000;">Logout</button>
      </nav>
    </aside>

    <main class="main">
      <header class="topbar">
        <div>
          <div class="chip">Einstellungen</div>
          <h1 class="topbar-title">Bank & Kategorien</h1>
          <div class="muted">Passe Rechnungs-Fußzeile, SEPA-Daten und Kategorien zentral an.</div>
        </div>
      </header>

      <div class="settings-grid">
        <section class="card">
          <div class="settings-card-header">
            <div>
              <h2 class="section-h">Bankdaten</h2>
              <div class="settings-card-subtitle">Wird im Rechnungs-PDF und SEPA-QR-Code verwendet.</div>
            </div>
          </div>

          <div id="bank-error" class="error-box hidden"></div>
          <div id="bank-success" class="success-box hidden"></div>

          <label class="input-label">Kontoinhaber</label>
          <input id="bank-holder" class="input" type="text" placeholder="z. B. Waldwirtschaft Heidekönig" />

          <label class="input-label">Bankname</label>
          <input id="bank-name" class="input" type="text" placeholder="z. B. VR-Bank Bonn Rhein-Sieg eG" />

          <div class="field-grid">
            <div>
              <label class="input-label">IBAN</label>
              <input id="bank-iban" class="input" type="text" placeholder="DE00 0000 0000 0000 0000 00" />
            </div>
            <div>
              <label class="input-label">BIC</label>
              <input id="bank-bic" class="input" type="text" placeholder="GENODEXX" />
            </div>
          </div>

          <div class="settings-note">Die Angaben werden für neue Rechnungen und den SEPA-QR-Code genutzt.</div>
          <div style="display:flex; gap:10px; margin-top:12px;">
            <button id="bank-save" class="primary-button">Bankdaten speichern</button>
            <button id="bank-reload" class="secondary-button">Zurücksetzen</button>
          </div>
        </section>

        <section class="card">
          <div class="settings-card-header">
            <div>
              <h2 class="section-h">Kategorien & Logos</h2>
              <div class="settings-card-subtitle">Labels und Logos für Rechnungen pflegen.</div>
            </div>
            <div class="settings-actions">
              <input id="cat-filter" class="input slim-input" type="text" placeholder="Suchen nach Key oder Label" />
              <button id="cat-refresh" class="secondary-button small-btn">Neu laden</button>
            </div>
          </div>

          <div id="error-box" class="error-box hidden"></div>
          <div id="cat-success" class="success-box hidden"></div>

          <div class="category-layout">
            <div class="category-stack">
              <div class="mini-card">
                <div class="mini-card-head">
                  <div>
                    <div class="badge subtle">Workflow</div>
                    <h3 class="section-h" style="margin:8px 0 6px;">Logo & Kategorie erfassen</h3>
                    <div class="settings-card-subtitle">1) Logo hochladen · 2) Felder ausfüllen · 3) Speichern</div>
                  </div>
                </div>

                <div class="step-block">
                  <div class="step-pill">1</div>
                  <div class="step-body">
                    <div class="mini-title">Logo hochladen (funktioniert eigenständig)</div>
                    <div class="settings-card-subtitle">PNG, JPG oder SVG · max. 1.5 MB · wird sofort gespeichert</div>
                    <div id="logo-dropzone" class="dropzone">
                      <input type="file" id="logo-file" accept=".png,.jpg,.jpeg,.svg" hidden />
                      <p class="dropzone-title">Datei hier ablegen oder klicken</p>
                      <p class="settings-note" id="logo-file-name">Keine Datei ausgewählt</p>
                      <div class="dropzone-actions">
                        <div class="inline-hint compact">Upload speichert ohne Kategorie. Danach erscheint die Datei im Dropdown.</div>
                      </div>
                    </div>
                    <div class="settings-note">Liegt nach Upload direkt unter <code>/public/logos/</code>.</div>
                  </div>
                </div>

                <div class="mini-divider"></div>

                <div class="step-block">
                  <div class="step-pill">2</div>
                  <div class="step-body">
                    <div class="mini-title">Kategorie anlegen</div>
                    <div class="settings-card-subtitle">Key = interner Schlüssel, Label = Anzeigename.</div>

                    <div class="field-grid">
                      <div>
                        <label class="input-label">Key (z. B. GESELLSCHAFTEN)</label>
                        <input id="cat-key" class="input" type="text" />
                        <div class="settings-note" id="cat-key-hint">Großbuchstaben und Unterstriche werden automatisch gesetzt.</div>
                      </div>
                      <div>
                        <label class="input-label">Label (Anzeige)</label>
                        <input id="cat-label" class="input" type="text" />
                        <div class="settings-note">So erscheint die Kategorie in Rechnungen.</div>
                      </div>
                      <div style="grid-column: span 2;">
                        <label class="input-label">Logo-Datei</label>
                        <select id="cat-logo" class="input select-input">
                          <option value="" selected disabled>Logo auswählen...</option>
                        </select>
                        <div class="settings-note">Upload fügt neue Dateien automatisch zur Liste hinzu.</div>
                      </div>
                    </div>

                    <div class="category-add-actions">
                      <button id="cat-add" class="primary-button">Kategorie speichern</button>
                      <div class="settings-note form-inline-hint">Speichern fügt den Eintrag rechts hinzu.</div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="mini-card tip-card">
                <h4 class="mini-title">Hinweise</h4>
                <ul class="tip-list">
                  <li>Key kurz und eindeutig halten (z. B. <code>HOTEL</code> oder <code>GESELLSCHAFT</code>).</li>
                  <li>Logo-Datei nur als Dateinamen eintragen. Upload legt sie unter <code>/public/logos/</code> ab.</li>
                  <li>Bestehende Zeilen rechts sind direkt editierbar; Speichern je Zeile anwenden.</li>
                </ul>
              </div>
            </div>

            <div class="category-table-block">
              <div class="table-top-note">
                <div>
                  <div class="badge subtle">Bestehende Kategorien</div>
                  <div class="settings-card-subtitle">Werte direkt anpassen und je Zeile speichern.</div>
                </div>
                <div class="settings-note">Logo-Vorschau nutzt den Dateinamen aus der Spalte.</div>
              </div>
              <div class="table-wrapper">
                <table class="table">
                  <thead>
                    <tr>
                      <th style="width: 18%;">Key</th>
                      <th>Label</th>
                      <th>Logo-Datei</th>
                      <th style="width: 90px;">Vorschau</th>
                      <th style="width: 180px;">Aktionen</th>
                    </tr>
                  </thead>
                  <tbody id="cat-body"></tbody>
                </table>
              </div>
            </div>
          </div>
        </section>
      </div>
    </main>
  </div>

  <script src="/nav.js"></script>
  <script src="/categories.js"></script>
</body>
</html>
