<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Rechnungen</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/style.css" />
</head>

<body>
  <div class="app-shell">

    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-title">Rechnungen</div>
        <nav class="sidebar-nav">
            <button class="nav-item" id="nav-dashboard">Dashboard</button>
            <button class="nav-item nav-item-active" id="nav-invoices">Rechnungs√ºbersicht</button>
            <button class="nav-item" id="nav-create">Neue Rechnung</button>
            <button class="nav-item" id="nav-customers">Kundenverwaltung</button>
            <button id="nav-users" class="nav-item">Benutzerverwaltung</button>
            <button id="nav-account" class="nav-item">Account</button>
            <button id="nav-roles" class="nav-item">Rollenverwaltung</button>
            <button id="nav-categories" class="nav-item">Einstellungen</button>
            <button id="nav-logout" class="nav-item" style="color:#b20000;">Logout</button>
        </nav>
    </aside>

    <main class="main">
      <header class="topbar">
        <h1 class="topbar-title">Rechnungs√ºbersicht</h1>
      </header>

      <div class="card" style="padding: 24px;">

        <!-- Suche + Filter -->
        <div class="invoice-controls">
          <input id="search" class="input" placeholder="üîç Suche nach Empf√§nger oder Nummer" />

          <select id="filter" class="input">
            <option value="all">Alle</option>
            <option value="open">Offen</option>
            <option value="sent">Versendet</option>
            <option value="paid">Bezahlt</option>
          </select>

          <select id="sort" class="input">
            <option value="date_desc">Datum ‚Üì</option>
            <option value="date_asc">Datum ‚Üë</option>
            <option value="num_desc">Nummer ‚Üì</option>
            <option value="num_asc">Nummer ‚Üë</option>
            <option value="total_desc">Betrag ‚Üì</option>
            <option value="total_asc">Betrag ‚Üë</option>
          </select>
        </div>
        
        <div style="display:flex; gap:12px; margin-bottom:14px;">
          <div id="multi-download-status"
              style="margin-bottom:14px; font-size:14px; color:#333; display:none;">
            <!-- Status wird per JS aktualisiert -->
          </div>
          <button id="btn-multi-download" class="primary-button small-btn">
            Ausgew√§hlte herunterladen
          </button>

          <button id="btn-multi-delete" class="danger-button small-btn">
            Ausgew√§hlte l√∂schen
          </button>
        </div>

        <!-- Tabelle -->
        <table class="table" style="margin-top: 20px;">
          <thead>
          <tr>
            <th><input type="checkbox" id="select-all"></th>
            <th>Nr.</th>
            <th>Datum</th>
            <th>Empf√§nger</th>
            <th>Gesamt (‚Ç¨)</th>
            <th>Status</th>
            <th>DATEV</th>
            <th>Aktion</th>
          </tr>
        </thead>
          <tbody id="invoice-list"></tbody>
        </table>

      </div>
    </main>
  </div>

  <!-- Modal: Rechnung per E-Mail -->
  <div id="email-modal" class="modal hidden">
    <div class="modal-content card" style="width: 520px; max-width: 90%;">
      <div style="display:flex; justify-content: space-between; align-items: center; gap: 12px; margin-bottom: 8px;">
        <div>
          <h3 class="modal-title" id="email-modal-title" style="margin: 0;">Rechnung per E-Mail versenden</h3>
          <div id="email-modal-subtitle" style="color:#6e6e73; font-size:13px; margin-top:4px;"></div>
        </div>
        <button id="email-close" class="secondary-button small-btn">Schlie√üen</button>
      </div>

      <div id="email-meta" style="display:flex; flex-wrap:wrap; gap:8px; margin: 6px 0 8px;">
        <span id="email-template-info" style="padding:6px 10px; background:#f5f5f7; border-radius:10px; font-size:12px; color:#4a4a4a;">Vorlage wird geladen‚Ä¶</span>
        <span id="email-from-info" style="padding:6px 10px; background:#f5f5f7; border-radius:10px; font-size:12px; color:#4a4a4a;">Absender wird geladen‚Ä¶</span>
        <span id="email-datev-info" style="padding:6px 10px; background:#f5f5f7; border-radius:10px; font-size:12px; color:#4a4a4a;">DATEV wird geladen‚Ä¶</span>
      </div>
      <div id="email-template-note" style="font-size:12px; color:#6e6e73; margin-bottom:6px;">Nachricht basiert auf der Kategorien-Vorlage und kann angepasst werden. √úber ‚ÄûSenden + DATEV‚Äú geht die Mail zus√§tzlich an die DATEV-Adresse (BCC).</div>

      <div style="display:flex; flex-direction:column; gap:12px; margin-top:10px;">
        <label style="font-weight:600; font-size:14px;">
          Empf√§nger E-Mail
          <input id="email-to" type="email" class="input" placeholder="kunde@example.com" style="margin-top:6px;">
        </label>

        <label style="font-weight:600; font-size:14px;">
          Betreff
          <input id="email-subject" type="text" class="input" style="margin-top:6px;">
        </label>

        <label style="font-weight:600; font-size:14px;">
          Nachricht
          <textarea id="email-message" class="input" rows="5" style="margin-top:6px; resize: vertical;" placeholder="Ihre Nachricht an den Empf√§nger"></textarea>
        </label>
      </div>

      <div id="email-status" style="font-size:13px; color:#444; min-height:18px; margin-top:10px;"></div>

      <div class="modal-actions">
        <button id="email-cancel" class="secondary-button">Abbrechen</button>
        <button id="email-send-datev" class="success-button">Senden + DATEV</button>
        <button id="email-send" class="primary-button">Senden</button>
      </div>
    </div>
  </div>

  <script src="/nav.js"></script>
  <script src="/invoices.js?v=3"></script>

  <!-- iOS Circle Loader Popup -->
<div id="download-progress-popup"
     style="position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 260px;
            padding: 30px 28px;
            background: rgba(255,255,255,0.88);
            backdrop-filter: blur(22px);
            -webkit-backdrop-filter: blur(22px);
            border-radius: 22px;
            box-shadow: 0 20px 45px rgba(0,0,0,0.15);
            text-align: center;
            display: none;
            z-index: 9999;">

    <h3 style="margin:0 0 18px; font-size:17px; font-weight:600; color:#1c1c1e;">
        Lade Rechnungen herunter‚Ä¶
    </h3>

    <!-- Kreis Loader -->
    <div class="ios-loader">
        <svg viewBox="0 0 100 100" class="ios-loader-svg">
            <circle class="ios-loader-track" cx="50" cy="50" r="42" />
            <circle class="ios-loader-fill"  cx="50" cy="50" r="42" />
        </svg>
        <div id="progress-text" class="ios-loader-text">0%</div>
    </div>

</div>
</body>
</html>
